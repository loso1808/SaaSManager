var settings = require('./config');

var ora = require('../lib/oracle');
if(typeof ora === 'function') {
  ora = ora(settings);
}

var sql = 'SELECT * FROM PRODUCT';

ora.createConnectionPool(settings, function (err, pool) {
  if (err) {
    console.error(err);
    return;
  }
  var count = 10;
  for (var i = 0; i < 10; i++) {
    // console.log(pool.getInfo());
    pool.getConnection(function (err, conn) {
      conn.setAutoCommit(false);
      console.log(pool.getInfo());
      console.log(sql);
      var start = Date.now();
      conn.execute(sql, [], function (err, results) {
        count--;
        if (err) {
          console.log(err);
        }
        console.log('Duration: %s ms', (Date.now() - start));
        if (!err && results) {
          console.log('Records found: %s', results.length);
        }
        conn.commit(function (err, result) {
          if (err) {
            console.log(err, result);
          }
          conn.close();
          console.log(pool.getInfo());
          if (count === 0) {
            pool.close();
            console.log(pool.getInfo());
          }
        });
      });
    });
  }
});
